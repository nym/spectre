        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>HandleSystem class / handle_system Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="handle_system" data-type="HandleSystem">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../handle_system.html">handle_system</a> &rsaquo; <a href="../handle_system/HandleSystem.html">HandleSystem</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../handle_system.html">handle_system</a></h2><ul class="icon">
<li><a href="../handle_system/Handle.html"><div class="icon-class"></div>Handle</a></li>
<li><div class="icon-class"></div><strong>HandleSystem</strong></li>
</ul>
<h2><div class="icon-library"></div><a href="../profiler.html">profiler</a></h2><h2><div class="icon-library"></div><a href="../spectre.html">spectre</a></h2><h2><div class="icon-library"></div><a href="../vector_math_browser.html">vector_math_browser</a></h2></div>
<div class="content">
        <h2><strong>HandleSystem</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<pre class="source">
class HandleSystem {
 List&lt;int&gt; _handles;
 int _totalCapacity;
 int _staticCapacity;

 int _freeHead;

 int _dynamicUsed;
 int _dynamicCapacity;

 HandleSystem(this._totalCapacity, this._staticCapacity) {
   _handles = new List&lt;int&gt;(_totalCapacity);
   int i;
   for (i = 0; i &lt; _staticCapacity; i++) {
     _handles[i] = Handle.makeStaticHandle(i, 0, 0);
   }
   _freeHead = i;
   for (; i &lt; _totalCapacity; i++) {
     int next = i+1;
     if (next == _totalCapacity) {
       next = Handle.IndexMask;
     }
    _handles[i] = Handle.makeNextPointer(0, next);
   }
   _dynamicUsed = 0;
   _dynamicCapacity = _totalCapacity - _staticCapacity;;
 }

 int get maxStaticIndex() =&gt; _staticCapacity;
 int get dynamicSize() =&gt; _dynamicUsed;
 int get dynamicCapacity() =&gt; _dynamicCapacity;
 int get dynamicAvailable() =&gt; _dynamicCapacity - _dynamicUsed;

 /// Returns true if index is in the static range
 bool isStaticIndex(int index) =&gt; index &gt;= 0 &amp;&amp; index &lt; _staticCapacity;

 /// Returns true if static index is free
 bool isStaticIndexFree(int index) {
   if (isStaticIndex(index) == false) {
     return false;
   }
   return Handle.checkStatusFlag(_handles[index], Handle.StatusUsed) == false;
 }

 /// Allocates a static handle at [index] with [type].
 /// Returns handle or [Handle.BadHandle] in case of error
 int allocateStaticIndex(int index, int type) {
   if (isStaticIndex(index) == false) {
     return Handle.BadHandle;
   }
   if (isStaticIndexFree(index) == false) {
     return Handle.BadHandle;
   }
   _handles[index] = Handle.makeStaticHandle(index, type, Handle.StatusUsed);
   return _handles[index];
 }

 /// Frees a static handle at [index]
 void freeStaticIndex(int index) {
   if (isStaticIndex(index) == false) {
     return;
   }
   _handles[index] = Handle.makeStaticHandle(index, 0, 0);
 }

 /// Allocates a static handle [handle]
 /// Returns [handle] or [Handle.BadHandle] in case of error
 int allocateStaticHandle(int handle) {
   int index = Handle.getIndex(handle);
   if (_isStaticHandle(handle) == false) {
     return Handle.BadHandle;
   }
   if (isStaticIndexFree(index) == false) {
     return Handle.BadHandle;
   }
   _handles[index] = handle;
   return handle;
 }

 /// Frees a static handle [handle]
 void freeStaticHandle(int handle) {
   int index = Handle.getIndex(handle);
   if (_isStaticHandle(handle) == false) {
     return;
   }
   _handles[index] = Handle.makeStaticHandle(index, 0, 0);
 }

 /// Set a static handle slot, no error checking
 /// Returns [handle] or [Handle.BadHandle] in case handle points outside of static area
 int setStaticHandle(int handle) {
   int index = Handle.getIndex(handle);
   if (_isStaticHandle(handle) == false) {
     return Handle.BadHandle;
   }
   _handles[index] = handle;
   return _handles[index];
 }

 /// Allocate a handle of [type] from the dynamic range
 /// Returns [handle] or [Handle.BadHandle]
 int allocateHandle(int type) {
   if (_dynamicUsed == _dynamicCapacity) {
     return Handle.BadHandle;
   }
   _dynamicUsed++;
   // Take first free handle
   int index = _freeHead;
   // Move free pointer forward
   _freeHead = Handle.getIndex(_handles[index]);
   int handle = _handles[index];
   // Index points to next element, point it at ourselves
   handle = Handle.setIndex(handle, index);
   //print('Allocating index ${index}');
   // Update serial number
   handle = Handle.nextSerial(handle);
   // Update flags
   handle = Handle.clearStatusFlag(handle, Handle.StatusFreeList);
   handle = Handle.setStatusFlag(handle, Handle.StatusUsed);
   // Set type
   handle = Handle.setType(handle, type);
   // Update handles array
   _handles[index] = handle;
   // Return new handle
   return handle;
 }

 /// Free [handle] from the dynamic range
 void freeHandle(int handle) {
   if (_dynamicUsed == 0) {
     return;
   }
   _dynamicUsed--;

   int handleIndex = Handle.getIndex(handle);
   int handleSerial = Handle.getSerial(handle);
   _handles[handleIndex] = Handle.makeNextPointer(handleSerial, _freeHead);
   _freeHead = handleIndex;
 }

 /// Returns true if [handle] is valid
 bool validHandle(int handle) {
   int index = Handle.getIndex(handle);
   if (index &lt; 0 || index &gt;= _totalCapacity) {
     return false;
   }
   int indexHandle = _handles[index];
   return handle == indexHandle;
 }

 bool _isStaticHandle(int handle) {
   int index = Handle.getIndex(handle);
   return Handle.isStaticHandle(handle) &amp;&amp; isStaticIndex(index);
 }

 void _dumpStaticTable() {
   print('Dumping static table');
   for (int i = 0; i &lt; _staticCapacity; i++) {
     int handle = _handles[i];
     int type = Handle.getType(handle);
     if (Handle.checkStatusFlag(handle, Handle.StatusUsed)) {
       print('[${Handle.getIndex(handle)}] Used ($handle) (type: $type)');
     } else {
       print('[${Handle.getIndex(handle)}] Free ($handle)');
     }
   }
 }

 void _dumpFreeList() {
   print('Dumping dynamic free list $dynamicAvailable');
   int i = _freeHead;
   while (i != Handle.IndexMask) {
     int serial = Handle.getSerial(_handles[i]);
     int next = Handle.getIndex(_handles[i]);
     print('$i ($serial) -&gt; $next');
     i = next;
   }
 }
}
</pre>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="HandleSystem">
<button class="show-code">Code</button>
new <strong>HandleSystem</strong>(int _totalCapacity, int _staticCapacity) <a class="anchor-link" href="#HandleSystem"
              title="Permalink to HandleSystem.HandleSystem">#</a></h4>
<div class="doc">
<pre class="source">
HandleSystem(this._totalCapacity, this._staticCapacity) {
 _handles = new List&lt;int&gt;(_totalCapacity);
 int i;
 for (i = 0; i &lt; _staticCapacity; i++) {
   _handles[i] = Handle.makeStaticHandle(i, 0, 0);
 }
 _freeHead = i;
 for (; i &lt; _totalCapacity; i++) {
   int next = i+1;
   if (next == _totalCapacity) {
     next = Handle.IndexMask;
   }
  _handles[i] = Handle.makeNextPointer(0, next);
 }
 _dynamicUsed = 0;
 _dynamicCapacity = _totalCapacity - _staticCapacity;;
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="dynamicAvailable">
<button class="show-code">Code</button>
final int         <strong>dynamicAvailable</strong> <a class="anchor-link"
            href="#dynamicAvailable"
            title="Permalink to HandleSystem.dynamicAvailable">#</a>
        </h4>
        <div class="doc">
<pre class="source">
int get dynamicAvailable() =&gt; _dynamicCapacity - _dynamicUsed;
</pre>
</div>
</div>
<div class="field"><h4 id="dynamicCapacity">
<button class="show-code">Code</button>
final int         <strong>dynamicCapacity</strong> <a class="anchor-link"
            href="#dynamicCapacity"
            title="Permalink to HandleSystem.dynamicCapacity">#</a>
        </h4>
        <div class="doc">
<pre class="source">
int get dynamicCapacity() =&gt; _dynamicCapacity;
</pre>
</div>
</div>
<div class="field"><h4 id="dynamicSize">
<button class="show-code">Code</button>
final int         <strong>dynamicSize</strong> <a class="anchor-link"
            href="#dynamicSize"
            title="Permalink to HandleSystem.dynamicSize">#</a>
        </h4>
        <div class="doc">
<pre class="source">
int get dynamicSize() =&gt; _dynamicUsed;
</pre>
</div>
</div>
<div class="field"><h4 id="maxStaticIndex">
<button class="show-code">Code</button>
final int         <strong>maxStaticIndex</strong> <a class="anchor-link"
            href="#maxStaticIndex"
            title="Permalink to HandleSystem.maxStaticIndex">#</a>
        </h4>
        <div class="doc">
<pre class="source">
int get maxStaticIndex() =&gt; _staticCapacity;
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="allocateHandle">
<button class="show-code">Code</button>
int <strong>allocateHandle</strong>(int type) <a class="anchor-link" href="#allocateHandle"
              title="Permalink to HandleSystem.allocateHandle">#</a></h4>
<div class="doc">
<p>Allocate a handle of 
<span class="param">type</span> from the dynamic rangeReturns <code>handle</code> or <a class="crossref" href="../handle_system/Handle.html#BadHandle">Handle.BadHandle</a></p>
<pre class="source">
int allocateHandle(int type) {
 if (_dynamicUsed == _dynamicCapacity) {
   return Handle.BadHandle;
 }
 _dynamicUsed++;
 // Take first free handle
 int index = _freeHead;
 // Move free pointer forward
 _freeHead = Handle.getIndex(_handles[index]);
 int handle = _handles[index];
 // Index points to next element, point it at ourselves
 handle = Handle.setIndex(handle, index);
 //print('Allocating index ${index}');
 // Update serial number
 handle = Handle.nextSerial(handle);
 // Update flags
 handle = Handle.clearStatusFlag(handle, Handle.StatusFreeList);
 handle = Handle.setStatusFlag(handle, Handle.StatusUsed);
 // Set type
 handle = Handle.setType(handle, type);
 // Update handles array
 _handles[index] = handle;
 // Return new handle
 return handle;
}
</pre>
</div>
</div>
<div class="method"><h4 id="allocateStaticHandle">
<button class="show-code">Code</button>
int <strong>allocateStaticHandle</strong>(int handle) <a class="anchor-link" href="#allocateStaticHandle"
              title="Permalink to HandleSystem.allocateStaticHandle">#</a></h4>
<div class="doc">
<p>Allocates a static handle 
<span class="param">handle</span>Returns 
<span class="param">handle</span> or <a class="crossref" href="../handle_system/Handle.html#BadHandle">Handle.BadHandle</a> in case of error</p>
<pre class="source">
int allocateStaticHandle(int handle) {
 int index = Handle.getIndex(handle);
 if (_isStaticHandle(handle) == false) {
   return Handle.BadHandle;
 }
 if (isStaticIndexFree(index) == false) {
   return Handle.BadHandle;
 }
 _handles[index] = handle;
 return handle;
}
</pre>
</div>
</div>
<div class="method"><h4 id="allocateStaticIndex">
<button class="show-code">Code</button>
int <strong>allocateStaticIndex</strong>(int index, int type) <a class="anchor-link" href="#allocateStaticIndex"
              title="Permalink to HandleSystem.allocateStaticIndex">#</a></h4>
<div class="doc">
<p>Allocates a static handle at 
<span class="param">index</span> with 
<span class="param">type</span>.Returns handle or <a class="crossref" href="../handle_system/Handle.html#BadHandle">Handle.BadHandle</a> in case of error</p>
<pre class="source">
int allocateStaticIndex(int index, int type) {
 if (isStaticIndex(index) == false) {
   return Handle.BadHandle;
 }
 if (isStaticIndexFree(index) == false) {
   return Handle.BadHandle;
 }
 _handles[index] = Handle.makeStaticHandle(index, type, Handle.StatusUsed);
 return _handles[index];
}
</pre>
</div>
</div>
<div class="method"><h4 id="freeHandle">
<button class="show-code">Code</button>
void <strong>freeHandle</strong>(int handle) <a class="anchor-link" href="#freeHandle"
              title="Permalink to HandleSystem.freeHandle">#</a></h4>
<div class="doc">
<p>Free 
<span class="param">handle</span> from the dynamic range</p>
<pre class="source">
void freeHandle(int handle) {
 if (_dynamicUsed == 0) {
   return;
 }
 _dynamicUsed--;

 int handleIndex = Handle.getIndex(handle);
 int handleSerial = Handle.getSerial(handle);
 _handles[handleIndex] = Handle.makeNextPointer(handleSerial, _freeHead);
 _freeHead = handleIndex;
}
</pre>
</div>
</div>
<div class="method"><h4 id="freeStaticHandle">
<button class="show-code">Code</button>
void <strong>freeStaticHandle</strong>(int handle) <a class="anchor-link" href="#freeStaticHandle"
              title="Permalink to HandleSystem.freeStaticHandle">#</a></h4>
<div class="doc">
<p>Frees a static handle 
<span class="param">handle</span></p>
<pre class="source">
void freeStaticHandle(int handle) {
 int index = Handle.getIndex(handle);
 if (_isStaticHandle(handle) == false) {
   return;
 }
 _handles[index] = Handle.makeStaticHandle(index, 0, 0);
}
</pre>
</div>
</div>
<div class="method"><h4 id="freeStaticIndex">
<button class="show-code">Code</button>
void <strong>freeStaticIndex</strong>(int index) <a class="anchor-link" href="#freeStaticIndex"
              title="Permalink to HandleSystem.freeStaticIndex">#</a></h4>
<div class="doc">
<p>Frees a static handle at 
<span class="param">index</span></p>
<pre class="source">
void freeStaticIndex(int index) {
 if (isStaticIndex(index) == false) {
   return;
 }
 _handles[index] = Handle.makeStaticHandle(index, 0, 0);
}
</pre>
</div>
</div>
<div class="method"><h4 id="isStaticIndex">
<button class="show-code">Code</button>
bool <strong>isStaticIndex</strong>(int index) <a class="anchor-link" href="#isStaticIndex"
              title="Permalink to HandleSystem.isStaticIndex">#</a></h4>
<div class="doc">
<p>Returns true if index is in the static range</p>
<pre class="source">
bool isStaticIndex(int index) =&gt; index &gt;= 0 &amp;&amp; index &lt; _staticCapacity;
</pre>
</div>
</div>
<div class="method"><h4 id="isStaticIndexFree">
<button class="show-code">Code</button>
bool <strong>isStaticIndexFree</strong>(int index) <a class="anchor-link" href="#isStaticIndexFree"
              title="Permalink to HandleSystem.isStaticIndexFree">#</a></h4>
<div class="doc">
<p>Returns true if static index is free</p>
<pre class="source">
bool isStaticIndexFree(int index) {
 if (isStaticIndex(index) == false) {
   return false;
 }
 return Handle.checkStatusFlag(_handles[index], Handle.StatusUsed) == false;
}
</pre>
</div>
</div>
<div class="method"><h4 id="setStaticHandle">
<button class="show-code">Code</button>
int <strong>setStaticHandle</strong>(int handle) <a class="anchor-link" href="#setStaticHandle"
              title="Permalink to HandleSystem.setStaticHandle">#</a></h4>
<div class="doc">
<p>Set a static handle slot, no error checkingReturns 
<span class="param">handle</span> or <a class="crossref" href="../handle_system/Handle.html#BadHandle">Handle.BadHandle</a> in case handle points outside of static area</p>
<pre class="source">
int setStaticHandle(int handle) {
 int index = Handle.getIndex(handle);
 if (_isStaticHandle(handle) == false) {
   return Handle.BadHandle;
 }
 _handles[index] = handle;
 return _handles[index];
}
</pre>
</div>
</div>
<div class="method"><h4 id="validHandle">
<button class="show-code">Code</button>
bool <strong>validHandle</strong>(int handle) <a class="anchor-link" href="#validHandle"
              title="Permalink to HandleSystem.validHandle">#</a></h4>
<div class="doc">
<p>Returns true if 
<span class="param">handle</span> is valid</p>
<pre class="source">
bool validHandle(int handle) {
 int index = Handle.getIndex(handle);
 if (index &lt; 0 || index &gt;= _totalCapacity) {
   return false;
 }
 int indexHandle = _handles[index];
 return handle == indexHandle;
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page was generated at 2012-11-10 15:19:59.648</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
